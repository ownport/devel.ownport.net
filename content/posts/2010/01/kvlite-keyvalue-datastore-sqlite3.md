Title: kvlite или KeyValue datastore на базе sqlite3
Author: d.rey
Date: 2010-01-22 08:09:00
Slug: kvlite-keyvalue-datastore-sqlite3
Tags: datastore,sqlite,key-value,python

Надеюсь не будет большим преувеличением если скажу, что sqlite одна из самых распространенных баз данных. Ее можно встреть:

- в мобильных телефонах Nokia, Google Android, Apple iPhone
- в броузерах Firefox, Safari, Chrome
- в приложениях таких компаний как Adobe, Google, McAfee, Microsoft, Skype, Sun, ...
- в сервисах Dropbox
- поддержка включена в языки программирования Python, PHP, REALbasic, ...


sqlite в своей практике я использую практически каждый день. Это и простейшие базы данных, всевозможные обработчики, сборщики информации, временные хранилища данных. Достаточно простая и быстрая база данных. И что самое главное, совершенно не нужна инсталляция. Существуют большое количество бесплатных приложений под различные операционные системы для работы как с консоли так и в GUI.

Для меня наибольший интерес представляет возможность работы с sqlite из python. Его поддержка включена в интерпретатор начиная с версии 2.5.  В целом все устраивает, но есть на мой взгляд несколько неудобств:

- сложности в изменении схемы базы данных. По правде сказать, это  касается всех реляционных баз данных, а не только sqlite. 
- Блокировки базы: _SQLite uses reader/writer locks on the entire database file. That means if any process is reading from any part of the database, all other processes are prevented from writing any other part of the database. Similarly, if any one process is writing to the database, all other processes are prevented from reading any other part of the database._

Попыткой исправить данные неудобства или скажем минимизировать их и стал проект, который я назвал как kvlite. kvlite - это оболочка над sqlite, которая позволяет хранить данные в виде пары ключ-значение на каждое поле. Каждая пара хранится в отдельном файле базы данных, что позволит уменьшить время блокировки файла. А чтобы добавить новое поле в базу достаточно будет создать объект класса KeyValue, который позволяет работать с парами ключ-значение.

**Возможности класса:**

создание файла БД sqlite для пары ключ/значение, где в качестве параметров передаются: путь, где будет или уже находится файл sqlite;  имя поля и его тип. Расширение ".sql3" добавляется по умолчанию. Если файл с таким именем уже существует, считается что пара уже создана. 

    :::python
    kv = KeyValue(path='store', name='field_int', value_type='INTEGER')
    
для добавления значений используется метод put. Добавление возможно по одному значению:

    :::python
    kv.put(1)
    kv.put(2)
    ...
    kv.put(9)
    
списком: 

    :::python
    kv.put((1,2,3))
    
либо парой ключ/значение в виде словаря: 

    :::python
    kv.put(('key1':1,'key2':2,'key3':3))
    
при добавлении по одному значению или списком, значение ключа назначается автоматически. Для удаления используется метод delete. Возможно путем передачи ключей (как одного, так и нескольких в виде списка):

    :::python
    kv.delete('3f558154-96da-4619-8428-23733054cfb6')
    kv.delete(('3f558154-96da-4619-8428-23733054cfb7', 3f558154-96da-4619-8428-23733054cfb8))
    
Выборка всех записей ключ/значение

    :::python
    kv.all()
    
выполнение SQL запроса. Данные хранятся в таблице kv c двумя полями, где k - поле ключа, v - поле значения

    :::python
    kv.sql('SELECT * FROM kv WHERE v LIKE "%test%"')
    
По умолчанию sqlite использует транзакции, соответственно для сохранения изменений необходимо вызвать commit

    :::python
    kv.commit()
    
Проект только начал свое существование, так что любая помощь советом/идеей как улучшить/исправления и т.д. всегда приветствуется. Вы можете помочь даже указав ссылки на похожие проекты (python+sqlite3). 

Домашняя страница проекта [http://code.google.com/p/kvlite/](http://code.google.com/p/kvlite/)

